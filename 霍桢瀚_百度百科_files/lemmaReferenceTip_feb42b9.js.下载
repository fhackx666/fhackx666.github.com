define("wiki-lemma:widget/lemma_content/mainContent/lemmaReference/lemmaReferenceTip/lemmaReferenceTip",function(e,i,n){function t(){f("span.ref.with-ctr").removeClass("with-ctr")}function a(e){f("span.ref[data-ctrid="+e+"]").addClass("with-ctr")}function r(e){for(var i=e.split(","),n=[],t=0;t<i.length;t++){var a=i[t],r=a.split(":");2===r.length&&n.push({ctrid:r[0],index:r[1]})}return n}var f=e("wiki-common:widget/lib/jquery/jquery"),l=e("wiki-common:widget/lib/jsmart/jsmart"),s=new l('{%foreach $refList as $ref%}\n{%$refIndex = ""%}\n{%$refTitle = ""%}\n{%if ($refList|count) > 1%}\n{%$refIndex = "[{%$ref.index%}]"%}\n{%/if%}\n{%if $ref.type == 1%}\n{%$refTitle = "{%if $ref.title%}{%$ref.title|f_escape_xml%}{%/if%}\n            {%if $ref.site%}{%$ref.site|f_escape_xml%}{%/if%}"%}\n{%else if $ref.type == 2%}\n{%$refTitle = "{%if $ref.author%}{%$ref.author|f_escape_xml%}{%/if%}\n            {%if $ref.title%}·{%$ref.title|f_escape_xml%}{%/if%}\n            {%if $ref.place%}·{%$ref.place|f_escape_xml%}{%/if%}\n            {%if $ref.publisher%}：{%$ref.publisher|f_escape_xml%}{%/if%}\n            {%if $ref.publishYear%}，{%$ref.publishYear|f_escape_xml%}{%/if%}"%}\n{%else if $ref.type == 3%}\n{%$refTitle = $ref.text%}\n{%else if $ref.type == 4%}\n{%$refTitle = "{%if $ref.name%}{%$ref.name|f_escape_xml%}·{%/if%} \n            {%if $ref.typeName%}{%$ref.typeName|f_escape_xml%}·{%/if%}\n            {%if $ref.isPublic > 0%}公开·{%else%}非公开·{%/if%}"%}\n{%/if%}\n<div \n        class="J-reference-tip__item reference-tip__item reference-tip__item--type{%$ref.type|f_escape_xml%}"\n        data-ctr="{%$ctrmap[$ref.index]|f_escape_xml%}"\n    >\n{%if $ref.doubtStatus == 1%}<span class="doubt-tag has-invalid"></span>\n{%/if%}\n{%if $ref.doubtStatus == 2%}<span class="doubt-tag has-doubt"></span>\n{%/if%}\n<a\n            href="{%if $ref.type == 4%}/personal/question/{%$lemmaTitle|f_escape_path%}/{%$subLemmaId|f_escape_path%}/{%$ref.id|f_escape_path%}{%elseif $ref.url%}{%$ref.url|f_escape_path%}{%/if%}"\n            target="_blank"\n        >\n<span\n                class="J-reference-tip__title reference-tip__title"\n                data-refindex={%$ref.index|f_escape_xml%}\n                data-refuuid={%$ref.uuid|f_escape_xml%}\n            >\n{%if $refIndex%}\n{%$refIndex|f_escape_xml%}&nbsp;{%/if%}\n{%$refTitle|f_escape_xml%}\n<em class="cmn-icon wiki-lemma-icons wiki-lemma-icons_reference-link reference-link"></em>\n{%if $ref.type == 4%}\n<span class="type4__remarks">\n由词条本人提供</span>\n{%/if%}\n</span>\n</a>\n{%if $ref.refDate%}\n<span class="reference-tip__date">\n[引用日期{%$ref.refDate|f_escape_xml%}]</span>\n{%/if%}\n{%if $ref.isPublic > 0%}\n{%if $ref.imgs && $ref.imgs.length > 0%}\n<div class="img-preview-container {%if $ref.refDate%}has-date{%/if%}">\n{%foreach from=$ref.imgs item=img%}\n{%if $img.picUrl%}\n<a href="{%$img.picUrl|f_escape_xml%}" target="_blank">\n<div class="img-preview-container__img" style="background-image:url({%$img.picUrl|f_escape_xml%})"></div>\n</a>\n{%elseif $img.picStatus == 1%}\n<a href="{%$img.waterMarkUrl|f_escape_xml%}" target="_blank">\n<div class="img-preview-container__img" style="background-image:url({%$img.waterMarkUrl|f_escape_xml%})"></div>\n</a>\n{%else%}\n<a href="{%\'//bkimg.cdn.bcebos.com/pic/\'|cat:$img.url%}" target="_blank">\n<div class="img-preview-container__img" style="background-image:url({%\'//bkimg.cdn.bcebos.com/pic/\'|cat:$img.url%})"></div>\n</a>\n{%/if%}\n{%/foreach%}\n</div>\n{%/if%}\n{%/if%}\n</div>\n{%/foreach%}'),c=e("wiki-common:widget/component/nslog/nslog"),m=e("wiki-lemma:widget/tools/clickstream/clickstream"),o=/(baike.otp.baidu.com)|(test-.*baike.appspace.baidu.com)/.test(window.location.host),p=function(e){function i(){for(var i=!1,n=0;n<e.reference.length;n++){var t=e.reference[n];4===parseInt(t.type,10)&&(i=!0)}i&&c(10090101)}function n(i){for(var n=0;n<e.reference.length;n++){var t=e.reference[n];if(parseInt(t.index,10)===parseInt(i,10))return t}return null}var l=['<div class="reference-tip J-referenceTip">',"<table><tr>",'<td class="content"></td>',"</tr></table>",'<em class="triangle-bg"></em>','<em class="triangle-border"></em>',"</div>"].join(""),p=f(l),u=this,d={lemmaId:f("#J-vars").data("lemmaid"),lemmaTitle:f("#J-vars").data("lemmatitle")},_=function(e){for(var i=e.toString().split("-"),n=parseInt(i[0],10),t=parseInt(i[i.length-1],10),a=[],r=n;t>=r;r++)a.push(r);return a};i();var $=null;this.display=function(i,t,f){var l=r(f);if(1===l.length&&l[0].ctrid&&a(l[0].ctrid),!$||!i.is($)){$=i;for(var u=_(t),g=i.offset(),h=[],v=!1,b=0;b<u.length;b++){var x=n(u[b]);x&&(4===parseInt(x.type,10)&&(v=!0),h.push(x))}v&&c(10090102);var w={};l.forEach(function(e){w[e.index]=e.ctrid});var k=s.fetch({ctrmap:w,refList:h,subLemmaId:e.subLemmaId,lemmaTitle:e.lemmaTitle,isOffline:o});p.find(".content").html(k),p.css({left:g.left-10,top:g.top+28});for(var b=0;b<u.length;b++)m.logViewEl({page:"lemma",element:"quote-float",lemmaTitle:d.lemmaTitle,lemmaId:d.lemmaId,index:u[b]});this.show()}},this.show=function(){p.show()},this.hide=function(){$=null,p.hide()};var g=function(){var e=null;f(document.body).on("mouseover","sup",function(){f(this).hasClass("normal")||(e&&(clearTimeout(e),e=null),u.display(f(this),f(this).data("sup"),f(this).data("ctrmap")))}).on("mouseout","sup",function(){e&&(clearTimeout(e),e=null),e=setTimeout(function(){u.hide()},200),t()}).on("mouseover",".J-referenceTip",function(){e&&(clearTimeout(e),e=null)}).on("mouseout",".J-referenceTip",function(){e&&(clearTimeout(e),e=null),e=setTimeout(function(){u.hide()},200)}),f(document.body).on("mouseover",".J-reference-tip__item",function(){f(this).data("ctr")&&a(f(this).data("ctr"))}).on("mouseout",".J-reference-tip__item",function(){t()}).on("click",".J-reference-tip__title",function(e){var i=f(e.target),n=i.data("refindex"),t=i.data("refuuid");m.logActClick({page:"lemma",element:"quote-float",lemmaTitle:d.lemmaTitle,lemmaId:d.lemmaId,index:n,uuid:t}),e.stopPropagation()}),p.appendTo(f(document.body))};g()};n.exports=p});